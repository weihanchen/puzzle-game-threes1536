function Enum(){}function firstLoad(){audio=document.getElementById("myTune"),scoreText=document.getElementById("scoreText"),audio.addEventListener("ended",function(){setTimeout(function(){audio.play()},500)},!1),this.addEventListener("keydown",doKeyDown,!0),Init()}function Init(){canvas=document.getElementById("puzzle-game-threes1536"),canvas.focus(),score=0,MetrixInit(),scoreText.innerHTML=score,onResize()}function onResize(){var r=document.getElementById("puzzle-game-threes1536-container");canvas.width=.95*r.offsetWidth,canvas.height=canvas.width,paint()}function musicControl(){musicPlay?(audio.pause(),document.getElementById("musicImage").src="picture/musicStop.png"):(audio.play(),document.getElementById("musicImage").src="picture/musicPlay.png"),musicPlay=!musicPlay}function doKeyDown(r){r.preventDefault(),38==r.keyCode?MetrixOn():40==r.keyCode?MetrixDown():39==r.keyCode?MetrixRight():37==r.keyCode&&MetrixLeft(),scoreText.innerHTML=score,paint();var e=getCheckWin();e==Enum.CheckType.win?winMessage():e==Enum.CheckType.lose&&loseMessage()}function MetrixInit(){arrayMetrix=new Array(row);for(var r=0;r<row;r++){arrayMetrix[r]=new Array(col);for(var e=0;e<col;e++)arrayMetrix[r][e]=""}for(var a=row*col,t=getRandomArray(a),r=0;r<basicNum;r++){var i=t[r],o=Math.floor(i/row),n=i%row;arrayMetrix[o][n]=r+1}}function getRandomArray(r){for(var e=new Array(r),a=0;a<r;a++)e[a]=a;for(var a=r-1;a>0;a--){var t=Math.floor(Math.random()*r),i=e[a];e[a]=e[t],e[t]=i}return e}function MetrixOn(){for(var r=[],e=0;e<col;e++){for(var a=!1,t=0;t<row-1;t++){var i=arrayMetrix[t][e],o=arrayMetrix[t+1][e];if(""!=o)if(""!=i){var n=i+o;(n==basicNum||i==o&&n>=2*basicNum)&&(score+=n,refreshBasicCount(n),arrayMetrix[t][e]=n,arrayMetrix[t+1][e]="",a=!0)}else arrayMetrix[t][e]=o,arrayMetrix[t+1][e]=i,a=!0}a&&r.push(e)}r.length>0&&addNewNumber(row-1,getAddForOne(r))}function MetrixDown(){for(var r=[],e=0;e<col;e++){for(var a=!1,t=row-1;t>0;t--){var i=arrayMetrix[t][e],o=arrayMetrix[t-1][e];if(""!=o)if(""!=i){var n=i+o;(n==basicNum||i==o&&n>=2*basicNum)&&(score+=n,refreshBasicCount(n),arrayMetrix[t][e]=n,arrayMetrix[t-1][e]="",a=!0)}else arrayMetrix[t][e]=o,arrayMetrix[t-1][e]=i,a=!0}a&&r.push(e)}r.length>0&&addNewNumber(0,getAddForOne(r))}function MetrixLeft(){for(var r=[],e=0;e<row;e++){for(var a=!1,t=0;t<col-1;t++){var i=arrayMetrix[e][t],o=arrayMetrix[e][t+1];if(""!=o)if(""!=i){var n=i+o;(n==basicNum||i==o&&n>=2*basicNum)&&(score+=n,refreshBasicCount(n),arrayMetrix[e][t]=n,arrayMetrix[e][t+1]="",a=!0)}else arrayMetrix[e][t]=o,arrayMetrix[e][t+1]=i,a=!0}a&&r.push(e)}r.length>0&&addNewNumber(getAddForOne(r),col-1)}function MetrixRight(){for(var r=[],e=0;e<row;e++){for(var a=!1,t=col-1;t>0;t--){var i=arrayMetrix[e][t],o=arrayMetrix[e][t-1];if(""!=o)if(""!=i){var n=i+o;(n==basicNum||i==o&&n>=2*basicNum)&&(score+=n,refreshBasicCount(n),arrayMetrix[e][t]=n,arrayMetrix[e][t-1]="",a=!0)}else arrayMetrix[e][t]=o,arrayMetrix[e][t-1]=i,a=!0}a&&r.push(e)}r.length>0&&addNewNumber(getAddForOne(r),0)}function getAddForOne(r){var e=Math.floor(Math.random()*r.length);return r[e]}function refreshBasicCount(r){r==basicNum?(arrayBasicCount[0]=arrayBasicCount[0]-1,arrayBasicCount[1]=arrayBasicCount[1]-1,arrayBasicCount[2]=arrayBasicCount[2]+1):r==2*basicNum&&(arrayBasicCount[2]=arrayBasicCount[2]-2)}function addNewNumber(r,e){var a=arrayMetrix[r][e];if(""===a){var t=getMinBasicCount();arrayMetrix[r][e]=t,arrayBasicCount[t-1]=arrayBasicCount[t-1]+1}}function getMinBasicCount(){for(var r=Number.MAX_VALUE,e=0,a=0;a<arrayBasicCount.length;a++)r>arrayBasicCount[a]&&(r=arrayBasicCount[a],e=a);return e+1}function getCheckWin(){for(var r=!1,e=0;e<row;e++)for(var a=0;a<col-1;a++){var t=arrayMetrix[e][a],i=arrayMetrix[e][a+1],o=t+i;if(i==winNumber||t==winNumber)return Enum.CheckType.win;(""==i||""==t||o==basicNum||t==i&&o>=2*basicNum)&&(r=!0)}for(var a=0;a<col;a++)for(var e=0;e<row-1;e++){var t=arrayMetrix[e][a],i=arrayMetrix[e+1][a],o=t+i;if(i==winNumber||t==winNumber)return Enum.CheckType.win;(""==i||""==t||o==basicNum||t==i&&o>=2*basicNum)&&(r=!0)}return r?Enum.CheckType.canMove:Enum.CheckType.lose}function winMessage(){swal({title:"<h1>Congratulation For Passing!</h1>",html:!0})}function loseMessage(){swal({title:'<h1 class="title">...Game Over...</h1>',text:"You have not added to the total to 1536 figures.",html:!0})}function paint(){for(var r=canvas.width,e=(canvas.height,document.getElementById("puzzle-game-threes1536").getContext("2d")),a=10,t=(r-a*(col-1))/col,i=t/2,o=t/3*2,n=0,c=0;c<row;c++){for(var u=0,s=0;s<col;s++){var y=arrayMetrix[c][s],l=getColor(y);e.fillStyle=l,e.fillRect(u,n,t,t),e.fillStyle="black",e.textAlign="center",e.font=i+"px Arial bold",e.fillText(y,u+i,n+o),u+=t+a}n+=t+a}}function getColor(r){return""==r?colors[0]:r>=basicNum?colors[basicNum]:colors[r]}var colors=new Array("rgb(182,217,217)","rgb(255,102,128)","rgb(102,204,255)","white"),arrayMetrix,row=5,col=5,basicNum=3,score=0,addCount=0,arrayBasicCount=new Array(1,1,1),winNumber=1536,musicPlay=!0;Enum.CheckType={win:0,lose:1,canMove:2};var audio,scoreText;window.onresize=onResize;